<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClipStack</title>
    <style>
        :root {
            --primary-color: #2196F3;
            --background-color: #f5f5f5;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--background-color);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        #clipForm {
            margin-bottom: 30px;
        }

        textarea {
            width: 100%;
            height: 150px;
            padding: 12px;
            margin-bottom: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            font-size: 16px;
        }

        button[type="submit"] {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: opacity 0.2s;
        }

        button[type="submit"]:hover {
            opacity: 0.9;
        }

        .clip-item {
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            padding: 18px;
            margin-bottom: 15px;
            transition: transform 0.2s;
        }

        .clip-item:hover {
            transform: translateY(-2px);
        }

        .meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .date {
            color: #666;
            font-size: 0.9em;
        }

        .actions button {
            background: none;
            border: none;
            padding: 6px;
            margin-left: 8px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .actions button:hover {
            transform: scale(1.1);
        }

        .content {
            color: #444;
            line-height: 1.6;
            white-space: pre-wrap;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            margin: 0; /* „Åì„ÅÆË°å„ÇíËøΩÂä† */
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 6px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; max-height: 0; padding: 0; margin: 0; }
        }

        .fade-out {
            animation: fadeOut 0.3s ease forwards;
        }
        /* Ê§úÁ¥¢„Éú„ÉÉ„ÇØ„ÇπÁî®„Çπ„Çø„Ç§„É´ËøΩÂä† */
        #searchInput {
            width: 100%;
            padding: 12px;
            margin: 15px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        /* „Éá„Éº„ÇøÁÆ°ÁêÜ„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´ËøΩÂä† */
        .data-management {
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }
        .data-management button,
        .data-management .import-label {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: opacity 0.3s;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .data-management .import-label {
            background-color: #2196F3 !important; /* „Ç§„É≥„Éù„Éº„Éà„ÅÆ„ÅøÈùíËâ≤ */
        }
        .data-management button[style*="background-color: #f44336"] {
            background-color: #f44336 !important;
        }

        .data-management button:hover,
        .data-management .import-label:hover {
            opacity: 0.9;
            text-decoration: none;
        }

        #importFile {
            display: none;
        }
        /* .import-label {
            background-color: #2196F3;
            cursor: pointer;
        } */

    </style>
</head>
<body>
    <div class="container">
        <h1>üìã ClipStack</h1>
        <!-- „Éá„Éº„ÇøÁÆ°ÁêÜ„Éú„Çø„É≥ËøΩÂä† -->
        <div class="data-management">
            <button onclick="exportData()">
                <svg width="16" height="16" viewBox="0 0 24 24" style="fill: white;">
                    <path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"/>
                </svg>
                „Ç®„ÇØ„Çπ„Éù„Éº„Éà
            </button>
            <label class="import-label">
                <svg width="16" height="16" viewBox="0 0 24 24" style="fill: white;">
                    <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/>
                </svg>
                „Ç§„É≥„Éù„Éº„Éà
                <input type="file" id="importFile" accept=".json">
            </label>
            <button onclick="deleteAllClips()" style="background-color: #f44336;">
                <svg width="16" height="16" viewBox="0 0 24 24" style="fill: white;">
                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                </svg>
                ‰∏ÄÊã¨ÂâäÈô§
            </button>
        </div>

        <form id="clipForm">
            <textarea 
                id="clipText" 
                placeholder="„Åì„Åì„Å´„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ•Âäõ..."
                maxlength="5000"
                required
            ></textarea>
            <button type="submit">‰øùÂ≠ò</button>
        </form>
        <!-- Ê§úÁ¥¢„Éú„ÉÉ„ÇØ„ÇπËøΩÂä† -->
        <input 
            type="text" 
            id="searchInput" 
            placeholder="„Ç≠„Éº„ÉØ„Éº„Éâ„ÅßÊ§úÁ¥¢..."
        >
        <div id="clipsContainer"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const clipForm = document.getElementById('clipForm');
            const clipsContainer = document.getElementById('clipsContainer');

            // ÂàùÊúüË™≠„ÅøËæº„Åø
            loadClips();

            clipForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const text = clipForm.clipText.value.trim();
                if (!text) return;

                const newClip = {
                    id: Date.now(),
                    text: text,
                    date: new Date().toISOString()
                };

                saveClip(newClip);
                // addClipToDOM(newClip);
                clipForm.reset();
            });

            clipsContainer.addEventListener('click', (e) => {
                const clipElement = e.target.closest('.clip-item');
                if (!clipElement) return;

                const clipId = clipElement.dataset.id;
                
                if (e.target.classList.contains('copy-btn')) {
                    handleCopy(clipId, e.target);
                } else if (e.target.classList.contains('delete-btn')) {
                    handleDelete(clipId, clipElement);
                }
            });

            // Ê§úÁ¥¢ÂÖ•Âäõ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºËøΩÂä†
            document.getElementById('searchInput').addEventListener('input', renderClips);
            
            // ÂàùÊúüË°®Á§∫
            renderClips();
        });

        // „ÇØ„É™„ÉÉ„ÉóÊèèÁîªÈñ¢Êï∞„ÇíÁµ±Âêà
        function renderClips() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const clips = JSON.parse(localStorage.getItem('clips') || '[]');
            
            // Ê§úÁ¥¢„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            const filteredClips = clips.filter(clip => 
                clip.text.toLowerCase().includes(searchTerm)
            );

            // Ë°®Á§∫Êõ¥Êñ∞
            clipsContainer.innerHTML = '';
            filteredClips.forEach(clip => {
                const clipElement = createClipElement(clip);
                clipsContainer.appendChild(clipElement);
            });
        }

        // „ÇØ„É™„ÉÉ„ÉóË¶ÅÁ¥†ÁîüÊàêÈñ¢Êï∞
        function createClipElement(clip) {
            const clipElement = document.createElement('div');
            clipElement.className = 'clip-item';
            clipElement.dataset.id = clip.id;

            const date = new Date(clip.date).toLocaleString();
            const contentPreview = clip.text.length > 100 
                ? clip.text.substring(0, 100) + '...' 
                : clip.text;

            clipElement.innerHTML = `
                <div class="meta">
                    <span class="date">${escapeHTML(date)}</span>
                    <div class="actions">
                        <button class="copy-btn">üìã</button>
                        <button class="delete-btn">üóëÔ∏è</button>
                    </div>
                </div>
                <p class="content" title="${escapeHTML(clip.text)}">
                    ${escapeHTML(contentPreview)}
                </p>
            `;

            return clipElement;
        }

        function escapeHTML(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function saveClip(clip) {
            const clips = JSON.parse(localStorage.getItem('clips') || '[]');
            clips.unshift(clip);
            localStorage.setItem('clips', JSON.stringify(clips));
            renderClips(); // ‰øùÂ≠òÂæå„Å´ÂÜçÊèèÁîª
        }

        function loadClips() {
            const clips = JSON.parse(localStorage.getItem('clips') || '[]');
            clips.forEach(clip => addClipToDOM(clip));
        }

        function addClipToDOM(clip) {
            const clipElement = document.createElement('div');
            clipElement.className = 'clip-item';
            clipElement.dataset.id = clip.id;

            const date = new Date(clip.date).toLocaleString();
            const contentPreview = clip.text.length > 100 
                ? clip.text.substring(0, 100) + '...' 
                : clip.text;

            clipElement.innerHTML = `
                <div class="meta">
                    <span class="date">${escapeHTML(date)}</span>
                    <div class="actions">
                        <button class="copy-btn">üìã</button>
                        <button class="delete-btn">üóëÔ∏è</button>
                    </div>
                </div>
                <p class="content" title="${escapeHTML(clip.text)}">
                    ${escapeHTML(contentPreview)}
                </p>
            `;

            clipsContainer.prepend(clipElement);
        }

        async function handleCopy(clipId, button) {
            try {
                const clips = JSON.parse(localStorage.getItem('clips') || '[]');
                const clip = clips.find(c => c.id == clipId);
                
                await navigator.clipboard.writeText(clip.text);
                button.textContent = '‚úÖ';
                setTimeout(() => button.textContent = 'üìã', 2000);
            } catch (err) {
                showToast('„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function handleDelete(clipId, element) {
            if (!confirm('Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;
            
            element.classList.add('fade-out');
            setTimeout(() => {
                element.remove();
                const clips = JSON.parse(localStorage.getItem('clips') || '[]');
                const filtered = clips.filter(c => c.id != clipId);
                localStorage.setItem('clips', JSON.stringify(filtered));
                renderClips(); // ÂâäÈô§Âæå„Å´ÂÜçÊèèÁîª
            }, 300);
        }
        function deleteAllClips() {
            if (!confirm('ÂÖ®„Å¶„ÅÆ„ÇØ„É™„ÉÉ„Éó„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì')) return;
            
            localStorage.removeItem('clips');
            renderClips();
            showToast('ÂÖ®„Å¶„ÅÆ„ÇØ„É™„ÉÉ„Éó„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
            
            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Áî®Ôºà‰ªªÊÑèÔºâ
            document.querySelectorAll('.clip-item').forEach(item => {
                item.classList.add('fade-out');
                setTimeout(() => item.remove(), 300);
            });
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
        // „Ç®„ÇØ„Çπ„Éù„Éº„ÉàÊ©üËÉΩ
        function exportData() {
            try {
                const clips = localStorage.getItem('clips') || '[]';
                const blob = new Blob([clips], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `clipstack-export-${new Date().toISOString().slice(0,10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showToast('„Ç®„ÇØ„Çπ„Éù„Éº„Éà„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü');
            } catch (error) {
                showToast('„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                console.error('Export error:', error);
            }
        }
        // „Ç§„É≥„Éù„Éº„ÉàÊ©üËÉΩ
        document.getElementById('importFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const importedData = JSON.parse(event.target.result);
                    if (!Array.isArray(importedData)) throw new Error('Invalid format');

                    // „Éá„Éº„ÇøÊ§úË®º
                    const isValid = importedData.every(item => 
                        item.id && item.text && item.date
                    );
                    
                    if (!isValid) throw new Error('Invalid data structure');

                    const confirmMerge = confirm(
                        `ÁèæÂú®„ÅÆ„Éá„Éº„ÇøÔºà${JSON.parse(localStorage.getItem('clips') || '[]').length}‰ª∂Ôºâ„Å´\n` +
                        `Êñ∞Ë¶è„Éá„Éº„ÇøÔºà${importedData.length}‰ª∂Ôºâ„Çí„Éû„Éº„Ç∏„Åó„Åæ„Åô„ÅãÔºü\n\n` +
                        '„Äå„Ç≠„É£„É≥„Çª„É´„Äç„ÇíÈÅ∏Êäû„Åô„Çã„Å®‰∏äÊõ∏„Åç„Åï„Çå„Åæ„Åô'
                    );

                    const currentData = JSON.parse(localStorage.getItem('clips') || '[]');
                    const mergedData = confirmMerge 
                        ? [...importedData, ...currentData] 
                        : [...importedData];

                    // ÈáçË§áÊéíÈô§
                    const uniqueData = mergedData.filter(
                        (v, i, a) => a.findIndex(t => t.id === v.id) === i
                    );

                    localStorage.setItem('clips', JSON.stringify(uniqueData));
                    renderClips();
                    showToast(`„Ç§„É≥„Éù„Éº„ÉàÊàêÂäü: ${importedData.length}‰ª∂„ÅÆ„Éá„Éº„Çø`);
                } catch (error) {
                    showToast('„Ç§„É≥„Éù„Éº„Éà„Å´Â§±Êïó: „Éï„Ç°„Ç§„É´ÂΩ¢Âºè„Åå‰∏çÊ≠£„Åß„Åô');
                    console.error('Import error:', error);
                }
            };
            reader.readAsText(file);
        });
    </script>
</body>
</html>